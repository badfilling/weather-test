//
//  FakeWeatherAPIClient.swift
//  Weather-task
//
//  Created by Artur Stepaniuk on 24/08/2020.
//  Copyright Â© 2020 Artur Stepaniuk. All rights reserved.
//

import Foundation

class FakeWeatherAPIClient: WeatherAPIClient {
    
    let currentWeatherJson = """
{"coord":{"lon":30.73,"lat":46.48},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"base":"stations","main":{"temp":25,"feels_like":23.02,"temp_min":25,"temp_max":25,"pressure":1013,"humidity":53},"visibility":10000,"wind":{"speed":5,"deg":140},"clouds":{"all":0},"dt":1598280941,"sys":{"type":1,"id":8915,"country":"UA","sunrise":1598238446,"sunset":1598287905},"timezone":10800,"id":698740,"name":"Odesa","cod":200}
"""
    
    let detailJson = """
{"cod":"200","message":0,"cnt":40,"list":[{"dt":1598313600,"main":{"temp":18.64,"feels_like":18.48,"temp_min":18.64,"temp_max":18.87,"pressure":1013,"sea_level":1013,"grnd_level":999,"humidity":71,"temp_kf":-0.23},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.69,"deg":188},"visibility":10000,"pop":0.12,"sys":{"pod":"n"},"dt_txt":"2020-08-25 00:00:00"},{"dt":1598324400,"main":{"temp":17.8,"feels_like":17.12,"temp_min":17.63,"temp_max":17.8,"pressure":1012,"sea_level":1012,"grnd_level":999,"humidity":71,"temp_kf":0.17},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":93},"wind":{"speed":2.07,"deg":229},"visibility":10000,"pop":0.88,"rain":{"3h":1.78},"sys":{"pod":"n"},"dt_txt":"2020-08-25 03:00:00"},{"dt":1598335200,"main":{"temp":18.01,"feels_like":17,"temp_min":17.98,"temp_max":18.01,"pressure":1012,"sea_level":1012,"grnd_level":999,"humidity":72,"temp_kf":0.03},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":96},"wind":{"speed":2.72,"deg":266},"visibility":10000,"pop":0.92,"rain":{"3h":1.49},"sys":{"pod":"d"},"dt_txt":"2020-08-25 06:00:00"},{"dt":1598346000,"main":{"temp":21.06,"feels_like":18.1,"temp_min":21.06,"temp_max":21.08,"pressure":1012,"sea_level":1012,"grnd_level":999,"humidity":53,"temp_kf":-0.02},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":4.74,"deg":270},"visibility":10000,"pop":0.92,"rain":{"3h":0.13},"sys":{"pod":"d"},"dt_txt":"2020-08-25 09:00:00"},{"dt":1598356800,"main":{"temp":22.43,"feels_like":18.44,"temp_min":22.43,"temp_max":22.43,"pressure":1012,"sea_level":1012,"grnd_level":998,"humidity":46,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":56},"wind":{"speed":5.86,"deg":274},"visibility":10000,"pop":0.96,"rain":{"3h":0.29},"sys":{"pod":"d"},"dt_txt":"2020-08-25 12:00:00"},{"dt":1598367600,"main":{"temp":22.62,"feels_like":18.57,"temp_min":22.62,"temp_max":22.62,"pressure":1011,"sea_level":1011,"grnd_level":998,"humidity":42,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":5.49,"deg":279},"visibility":10000,"pop":0.36,"sys":{"pod":"d"},"dt_txt":"2020-08-25 15:00:00"},{"dt":1598378400,"main":{"temp":19.93,"feels_like":17.23,"temp_min":19.93,"temp_max":19.93,"pressure":1012,"sea_level":1012,"grnd_level":999,"humidity":51,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":3},"wind":{"speed":3.73,"deg":270},"visibility":10000,"pop":0.16,"sys":{"pod":"n"},"dt_txt":"2020-08-25 18:00:00"},{"dt":1598389200,"main":{"temp":18.23,"feels_like":16.28,"temp_min":18.23,"temp_max":18.23,"pressure":1013,"sea_level":1013,"grnd_level":999,"humidity":57,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.69,"deg":258},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-25 21:00:00"},{"dt":1598400000,"main":{"temp":17.05,"feels_like":15.01,"temp_min":17.05,"temp_max":17.05,"pressure":1012,"sea_level":1012,"grnd_level":999,"humidity":60,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02n"}],"clouds":{"all":19},"wind":{"speed":2.69,"deg":204},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-26 00:00:00"},{"dt":1598410800,"main":{"temp":16.52,"feels_like":13.47,"temp_min":16.52,"temp_max":16.52,"pressure":1011,"sea_level":1011,"grnd_level":997,"humidity":60,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":3.95,"deg":188},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-26 03:00:00"},{"dt":1598421600,"main":{"temp":18.42,"feels_like":14.8,"temp_min":18.42,"temp_max":18.42,"pressure":1009,"sea_level":1009,"grnd_level":995,"humidity":59,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":48},"wind":{"speed":5.34,"deg":190},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-26 06:00:00"},{"dt":1598432400,"main":{"temp":23.05,"feels_like":18.84,"temp_min":23.05,"temp_max":23.05,"pressure":1007,"sea_level":1007,"grnd_level":993,"humidity":45,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":90},"wind":{"speed":6.26,"deg":205},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-26 09:00:00"},{"dt":1598443200,"main":{"temp":27.05,"feels_like":21.53,"temp_min":27.05,"temp_max":27.05,"pressure":1004,"sea_level":1004,"grnd_level":991,"humidity":36,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":48},"wind":{"speed":8.22,"deg":225},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-26 12:00:00"},{"dt":1598454000,"main":{"temp":24.46,"feels_like":19.85,"temp_min":24.46,"temp_max":24.46,"pressure":1003,"sea_level":1003,"grnd_level":990,"humidity":44,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":70},"wind":{"speed":7.22,"deg":264},"visibility":10000,"pop":0.34,"sys":{"pod":"d"},"dt_txt":"2020-08-26 15:00:00"},{"dt":1598464800,"main":{"temp":19.12,"feels_like":14.16,"temp_min":19.12,"temp_max":19.12,"pressure":1005,"sea_level":1005,"grnd_level":992,"humidity":52,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":57},"wind":{"speed":6.78,"deg":282},"visibility":10000,"pop":0.66,"rain":{"3h":0.94},"sys":{"pod":"n"},"dt_txt":"2020-08-26 18:00:00"},{"dt":1598475600,"main":{"temp":18.21,"feels_like":13.58,"temp_min":18.21,"temp_max":18.21,"pressure":1006,"sea_level":1006,"grnd_level":992,"humidity":57,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":83},"wind":{"speed":6.51,"deg":246},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-26 21:00:00"},{"dt":1598486400,"main":{"temp":16.29,"feels_like":11.24,"temp_min":16.29,"temp_max":16.29,"pressure":1004,"sea_level":1004,"grnd_level":990,"humidity":72,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":91},"wind":{"speed":7.78,"deg":242},"visibility":10000,"pop":0.38,"rain":{"3h":0.41},"sys":{"pod":"n"},"dt_txt":"2020-08-27 00:00:00"},{"dt":1598497200,"main":{"temp":16.51,"feels_like":11.34,"temp_min":16.51,"temp_max":16.51,"pressure":1002,"sea_level":1002,"grnd_level":989,"humidity":78,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":8.56,"deg":255},"visibility":10000,"pop":1,"rain":{"3h":2.03},"sys":{"pod":"n"},"dt_txt":"2020-08-27 03:00:00"},{"dt":1598508000,"main":{"temp":16.74,"feels_like":11.29,"temp_min":16.74,"temp_max":16.74,"pressure":1004,"sea_level":1004,"grnd_level":990,"humidity":80,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":99},"wind":{"speed":9.25,"deg":286},"visibility":10000,"pop":1,"rain":{"3h":0.53},"sys":{"pod":"d"},"dt_txt":"2020-08-27 06:00:00"},{"dt":1598518800,"main":{"temp":20.05,"feels_like":15.18,"temp_min":20.05,"temp_max":20.05,"pressure":1006,"sea_level":1006,"grnd_level":993,"humidity":63,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":88},"wind":{"speed":8.19,"deg":288},"visibility":10000,"pop":1,"rain":{"3h":0.56},"sys":{"pod":"d"},"dt_txt":"2020-08-27 09:00:00"},{"dt":1598529600,"main":{"temp":19.66,"feels_like":14.93,"temp_min":19.66,"temp_max":19.66,"pressure":1008,"sea_level":1008,"grnd_level":994,"humidity":64,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":82},"wind":{"speed":7.94,"deg":273},"visibility":10000,"pop":1,"rain":{"3h":0.32},"sys":{"pod":"d"},"dt_txt":"2020-08-27 12:00:00"},{"dt":1598540400,"main":{"temp":19.86,"feels_like":15.21,"temp_min":19.86,"temp_max":19.86,"pressure":1008,"sea_level":1008,"grnd_level":995,"humidity":63,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":93},"wind":{"speed":7.79,"deg":285},"visibility":10000,"pop":0.46,"rain":{"3h":0.18},"sys":{"pod":"d"},"dt_txt":"2020-08-27 15:00:00"},{"dt":1598551200,"main":{"temp":18.28,"feels_like":13.93,"temp_min":18.28,"temp_max":18.28,"pressure":1010,"sea_level":1010,"grnd_level":996,"humidity":62,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":95},"wind":{"speed":6.62,"deg":287},"visibility":10000,"pop":0.23,"sys":{"pod":"n"},"dt_txt":"2020-08-27 18:00:00"},{"dt":1598562000,"main":{"temp":16.62,"feels_like":13.4,"temp_min":16.62,"temp_max":16.62,"pressure":1011,"sea_level":1011,"grnd_level":998,"humidity":68,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":4.94,"deg":287},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-27 21:00:00"},{"dt":1598572800,"main":{"temp":14.65,"feels_like":12.12,"temp_min":14.65,"temp_max":14.65,"pressure":1012,"sea_level":1012,"grnd_level":998,"humidity":80,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":74},"wind":{"speed":4.17,"deg":280},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-28 00:00:00"},{"dt":1598583600,"main":{"temp":13.49,"feels_like":11.82,"temp_min":13.49,"temp_max":13.49,"pressure":1012,"sea_level":1012,"grnd_level":999,"humidity":88,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":70},"wind":{"speed":3.07,"deg":288},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-28 03:00:00"},{"dt":1598594400,"main":{"temp":14.7,"feels_like":13.19,"temp_min":14.7,"temp_max":14.7,"pressure":1013,"sea_level":1013,"grnd_level":999,"humidity":79,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":54},"wind":{"speed":2.66,"deg":279},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-28 06:00:00"},{"dt":1598605200,"main":{"temp":19.36,"feels_like":17.93,"temp_min":19.36,"temp_max":19.36,"pressure":1013,"sea_level":1013,"grnd_level":1000,"humidity":54,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":3},"wind":{"speed":2.03,"deg":268},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-28 09:00:00"},{"dt":1598616000,"main":{"temp":22.32,"feels_like":19.99,"temp_min":22.32,"temp_max":22.32,"pressure":1012,"sea_level":1012,"grnd_level":999,"humidity":38,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":2},"wind":{"speed":2.43,"deg":233},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-28 12:00:00"},{"dt":1598626800,"main":{"temp":22.73,"feels_like":20.44,"temp_min":22.73,"temp_max":22.73,"pressure":1012,"sea_level":1012,"grnd_level":998,"humidity":36,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":2.23,"deg":204},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-28 15:00:00"},{"dt":1598637600,"main":{"temp":20.16,"feels_like":17.51,"temp_min":20.16,"temp_max":20.16,"pressure":1011,"sea_level":1011,"grnd_level":998,"humidity":42,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":7},"wind":{"speed":2.74,"deg":120},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-28 18:00:00"},{"dt":1598648400,"main":{"temp":17.97,"feels_like":14.9,"temp_min":17.97,"temp_max":17.97,"pressure":1011,"sea_level":1011,"grnd_level":998,"humidity":53,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":39},"wind":{"speed":3.8,"deg":138},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-28 21:00:00"},{"dt":1598659200,"main":{"temp":17.34,"feels_like":13.49,"temp_min":17.34,"temp_max":17.34,"pressure":1011,"sea_level":1011,"grnd_level":997,"humidity":58,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":38},"wind":{"speed":5.18,"deg":133},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-29 00:00:00"},{"dt":1598670000,"main":{"temp":16.66,"feels_like":12.93,"temp_min":16.66,"temp_max":16.66,"pressure":1010,"sea_level":1010,"grnd_level":996,"humidity":64,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":30},"wind":{"speed":5.33,"deg":132},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-29 03:00:00"},{"dt":1598680800,"main":{"temp":17.7,"feels_like":13.54,"temp_min":17.7,"temp_max":17.7,"pressure":1008,"sea_level":1008,"grnd_level":995,"humidity":63,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":62},"wind":{"speed":6.23,"deg":133},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-29 06:00:00"},{"dt":1598691600,"main":{"temp":23.23,"feels_like":18.42,"temp_min":23.23,"temp_max":23.23,"pressure":1007,"sea_level":1007,"grnd_level":993,"humidity":46,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":97},"wind":{"speed":7.32,"deg":141},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-29 09:00:00"},{"dt":1598702400,"main":{"temp":27.36,"feels_like":23.29,"temp_min":27.36,"temp_max":27.36,"pressure":1005,"sea_level":1005,"grnd_level":992,"humidity":38,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":94},"wind":{"speed":6.6,"deg":177},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-29 12:00:00"},{"dt":1598713200,"main":{"temp":29.26,"feels_like":26.77,"temp_min":29.26,"temp_max":29.26,"pressure":1005,"sea_level":1005,"grnd_level":992,"humidity":40,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":69},"wind":{"speed":5.49,"deg":234},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-08-29 15:00:00"},{"dt":1598724000,"main":{"temp":24.9,"feels_like":25.63,"temp_min":24.9,"temp_max":24.9,"pressure":1006,"sea_level":1006,"grnd_level":993,"humidity":58,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":34},"wind":{"speed":1.83,"deg":252},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-08-29 18:00:00"},{"dt":1598734800,"main":{"temp":22.28,"feels_like":24.26,"temp_min":22.28,"temp_max":22.28,"pressure":1007,"sea_level":1007,"grnd_level":994,"humidity":70,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":0},"wind":{"speed":0.31,"deg":297},"visibility":10000,"pop":0.59,"rain":{"3h":1.21},"sys":{"pod":"n"},"dt_txt":"2020-08-29 21:00:00"}],"city":{"id":756135,"name":"Warsaw","coord":{"lat":52.2298,"lon":21.0118},"country":"PL","population":1000000,"timezone":7200,"sunrise":1598326588,"sunset":1598377194}}
"""
    func loadForecast(latitude: Double, longitude: Double, completion: @escaping (Result<[WeatherForecast], Error>) -> Void) -> URLSessionDataTask? {
        do {
            let decoder = JSONDecoder()
            let data = detailJson.data(using: .utf8)
            let dto = try decoder.decode(DetailForecastDTO.self, from: data!)
            var forecasts = [WeatherForecast]()
            for forecastDTO in dto.list ?? [] {
                forecasts.append(try forecastDTO.convert())
            }
            completion(.success(forecasts))
        } catch {
            completion(.failure(error))
        }
        return nil
    }
    
    func loadCurrentWeather(latitude: Double, longitude: Double, completion: @escaping (Result<LocationWeatherData, Error>) -> Void) -> URLSessionDataTask? {
        let decoder = JSONDecoder()
        do {
            let data = currentWeatherJson.data(using: .utf8)
            let dto = try decoder.decode(CurrentWeatherDTO.self, from: data!)
            let weather = try dto.toLocation()
            completion(.success(weather))
        } catch {
            completion(.failure(error))
        }
        return nil
    }
}
